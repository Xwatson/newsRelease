<% include header %>
<div class="news-account">
    <div class="row">
        <div class="col-md-5">
            <ul class="na-left">
                <li><a href="javascript:;" data-href="na-user-info">基本信息</a></li>
                <li><a href="javascript:;" data-href="na-user-head-portrait">修改头像</a></li>
                <li><a href="javascript:;" data-href="na-user-password">修改密码</a></li>
            </ul>
        </div>
        <div class="col-md-7 na-right">
            <div class="na-user-info" style="display: block">
                <form class="form-horizontal" onsubmit="return updateUser(event)">
                    <div class="form-group">
                        <label for="input1" class="col-sm-2 control-label"><span class="text-danger">*</span>昵称：</label>
                        <div class="col-sm-10">
                            <input type="text" name="nickName" class="form-control" id="input1" disabled>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="input2" class="col-sm-2 control-label"><span class="text-danger">*</span>邮箱：</label>
                        <div class="col-sm-10">
                            <input type="email" name="email" class="form-control" id="input2" placeholder="请输入email"
                                   disabled>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="input4" class="col-sm-2 control-label">姓名：</label>
                        <div class="col-sm-10">
                            <input type="text" name="name" class="form-control" id="input4" placeholder="请输入姓名">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="input4" class="col-sm-2 control-label">手机：</label>
                        <div class="col-sm-10">
                            <input type="text" name="phone" class="form-control" id="input4" placeholder="请输入手机"
                                   maxlength="11"
                                   pattern="^(0|86|17951)?1[0-9]{10}"
                                   oninvalid="setCustomValidity('请输入11位手机号');">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="input6" class="col-sm-2 control-label">性别：</label>
                        <div class="col-sm-10">
                            <label class="radio-inline">
                                <input type="radio" name="gender" id="inlineRadio1" value="MAN" checked> 男
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="gender" id="inlineRadio2" value="FEMALE"> 女
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="gender" id="inlineRadio3" value="SECRECY"> 保密
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="input7" class="col-sm-2 control-label">联系地址：</label>
                        <div class="col-sm-10">
                            <input type="text" name="address" class="form-control" id="input7" placeholder="请输入联系地址">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="input8" class="col-sm-2 control-label">QQ：</label>
                        <div class="col-sm-10">
                            <input type="text" name="qq" class="form-control" id="input8" placeholder="请输入qq">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="input9" class="col-sm-2 control-label">生日：</label>
                        <div class="col-sm-10">
                            <input type="date" name="birthday" class="form-control" id="input9" placeholder="请输入生日">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="input10" class="col-sm-2 control-label">介绍：</label>
                        <div class="col-sm-10">
                            <textarea class="form-control" name="introduction" rows="2" id="input10"
                                      placeholder="请输入一段介绍"></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button type="submit" class="btn btn-primary btn-block">确认修改</button>
                        </div>
                    </div>
            </form>
            </div>
            <div class="na-user-password">
            <form class="form-horizontal" onsubmit="return updatePassword(event)">
                <div class="form-group">
                    <label for="input1" class="col-sm-2 control-label"><span class="text-danger">*</span>原始密码：</label>
                    <div class="col-sm-10">
                        <input type="text" name="oldPassword" class="form-control" id="input1" minlength="6" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="input2" class="col-sm-2 control-label"><span class="text-danger">*</span>新密码：</label>
                    <div class="col-sm-10">
                        <input type="text" name="password" class="form-control" id="input2" minlength="6" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="input2" class="col-sm-2 control-label"><span class="text-danger">*</span>确认密码：</label>
                    <div class="col-sm-10">
                        <input type="text" name="enterPassword" class="form-control" id="input2" minlength="6" required>
                    </div>
                    <div class="form-error">两次密码不一致</div>
                </div>
                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <button type="submit" class="btn btn-primary">修改</button>
                    </div>
                </div>
            </form>
        </div>
            <div class="na-user-head-portrait">
            <form class="form-horizontal" onsubmit="return updatePortrait(event)">
                <div class="form-group">
                    <label for="headPortrait" class="col-sm-2 control-label"><span class="text-danger">*</span>图片：</label>
                    <div class="col-sm-10">
                        <p>
                            <img src="" width="70" height="70" id="head-portrait-img" alt="">
                        </p>
                        <input type="file" name="headPortrait" class="form-control" id="headPortrait">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <button type="submit" class="btn btn-primary">修改</button>
                    </div>
                </div>
            </form>
        </div>
        </div>
</div>
    <div class="modal fade bs-example-modal-sm" id="na-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
            </div>
        </div>
    </div>
</div>
<script src="/js/ajaxfileupload.js"></script>
<script>
    function updateUser(e) {
        e.preventDefault()
        var name = $('.na-user-info [name="name"]').val()
        var phone = $('.na-user-info [name="phone"]').val()
        var gender = $('.na-user-info [name="gender"]').val()
        var address = $('.na-user-info [name="address"]').val()
        var qq = $('.na-user-info [name="qq"]').val()
        var birthday = $('.na-user-info [name="birthday"]').val()
        var introduction = $('.na-right [name="introduction"]').val()
        $.ajax({
            url:'/user/updatePassword',
            type:'post',
            data:{ name:name, phone:phone, gender:gender, address:address, qq:qq, birthday:birthday, introduction:introduction },
            success:function (data) {
                showModal(data)
            },
            error:function (err) {
                alert('修改失败，请联系管理员！')
            }
        })
        return false
    }
    function updatePassword(e) {
        e.preventDefault()
        var oldPassword = $('.na-user-password [name="oldPassword"]').val()
        var password = $('.na-user-password [name="password"]').val()
        var enterPassword = $('.na-user-password [name="enterPassword"]').val()
        var $enterPwdGroup = $('.na-user-password [name="enterPassword"]').parent().parent()
        if (password !== enterPassword) {
            $enterPwdGroup.addClass('has-error')
            return false
        } else {
            $enterPwdGroup.removeClass('has-error')
        }
        $.ajax({
            url:'/user/updatePassword',
            type:'post',
            data:{ oldPassword:oldPassword, password:password },
            success:function (data) {
                showModal(data)
            },
            error:function (err) {
                alert('修改失败，请联系管理员！')
            }
        })
        return false
    }
    function updatePortrait(e) {
        e.preventDefault()
        $.ajaxFileUpload({
            url: '/user/updateHeadPortrait',
            secureuri:false,
            fileElementId:'headPortrait',
            success:function (data) {
                showModal(data)
            },
            error:function (data, status, e) {
                alert(e)
            }
        })
        return false
    }
    function showModal(data) {
        $('#na-modal .modal-content').html(data.message)
        $('#na-modal').modal('show')
    }
    $(function () {
        $('.na-left li').on('click', function () {
            $('.na-right > div').hide()
            $('.' + $(this).data('href')).show()
        })
        $('.na-user-head-portrait [name="headPortrait"]').on('change', function () {
            var file = $(this).get(0).file[0]
            var reader = new FileReader();
            reader.onload = function(e){
                var data = e.target.result;
                $('#head-portrait-img').attr('src', data)
            }
            // 以DataURL的形式读取文件:
            reader.readAsDataURL(file);
        })
    })
</script>
<% include footer.ejs %>